<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Engineer's Digital Calculator v4.0</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2344/2344233.png" type="image/png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/algebrite@1.4.0/dist/algebrite.bundle-for-browser.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --neon-green: #0f0;
            --neon-cyan: #0ff;
            --neon-pink: #f0f;
            --neon-yellow: #ff0;
            --dark-bg: #050505;
            --panel-bg: rgba(5, 15, 5, 0.92);
            --border-color: #333;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background-color: black;
            color: #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            overflow-x: hidden;
            margin: 0;
        }

        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.1) 50%, rgba(0, 0, 0, 0.1));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 50;
            opacity: 0.4;
        }

        .glass-panel {
            background: var(--panel-bg);
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.1);
            backdrop-filter: blur(8px);
            border-radius: 4px;
            position: relative;
        }

        .glass-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--neon-green), transparent);
            opacity: 0.8;
        }

        input,
        select,
        textarea {
            background: #080808;
            border: 1px solid #444;
            border-left: 3px solid var(--neon-green);
            color: #fff;
            font-family: 'Courier New', monospace;
            padding: 8px;
            font-weight: 600;
            outline: none;
            transition: 0.3s;
        }

        input:focus,
        textarea:focus {
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.4);
            border-color: var(--neon-green);
            background: #001a00;
        }

        .cyber-btn {
            background: rgba(0, 30, 0, 0.7);
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            text-transform: uppercase;
            font-weight: bold;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }

        .cyber-btn:hover {
            background: var(--neon-green);
            color: black;
            box-shadow: 0 0 20px var(--neon-green);
            text-shadow: none;
        }

        .cyber-btn:active {
            transform: scale(0.98);
        }

        .cyber-btn-secondary {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
        }

        .cyber-btn-secondary:hover {
            background: var(--neon-cyan);
            color: black;
            box-shadow: 0 0 20px var(--neon-cyan);
        }

        .cyber-btn-accent {
            border-color: var(--neon-pink);
            color: var(--neon-pink);
            text-shadow: 0 0 5px rgba(255, 0, 255, 0.5);
        }

        .cyber-btn-accent:hover {
            background: var(--neon-pink);
            color: black;
            box-shadow: 0 0 20px var(--neon-pink);
        }

        .cyber-btn-warning {
            border-color: #f55;
            color: #f55;
            text-shadow: 0 0 5px rgba(255, 85, 85, 0.5);
        }

        .cyber-btn-warning:hover {
            background: #f55;
            color: black;
            box-shadow: 0 0 20px #f55;
        }

        .tab-btn {
            border-bottom: 2px solid transparent;
            opacity: 0.7;
            transition: 0.3s;
            position: relative;
            color: #aaa;
        }

        .tab-btn:hover {
            opacity: 1;
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab-btn.active {
            border-bottom: 2px solid var(--neon-cyan);
            color: var(--neon-cyan);
            opacity: 1;
            text-shadow: 0 0 10px var(--neon-cyan);
            background: rgba(0, 255, 255, 0.1);
            font-weight: bold;
        }

        .result-box {
            border-left: 4px solid var(--neon-cyan);
            background: rgba(0, 20, 25, 0.8);
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            color: #fff;
            animation: fadeIn 0.5s ease-in-out;
            font-weight: 500;
            max-height: 500px;
            overflow-y: auto;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .glowing-text {
            text-shadow: 0 0 5px var(--neon-green), 0 0 15px var(--neon-green);
        }

        .student-card {
            background: rgba(0, 20, 0, 0.6);
            border: 1px solid #333;
            transition: all 0.3s ease;
        }

        .student-card:hover {
            border-color: var(--neon-cyan);
            transform: translateY(-5px);
            background: rgba(0, 40, 40, 0.8);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }

        .calc-key {
            background: #111;
            border: 1px solid #333;
            color: #ddd;
            font-size: 1.1rem;
            padding: 15px;
            transition: 0.1s;
            font-weight: bold;
            cursor: pointer;
        }

        .calc-key:hover {
            background: #222;
            border-color: var(--neon-green);
        }

        .calc-key:active {
            transform: scale(0.95);
            background: #333;
        }

        .calc-key.op {
            color: var(--neon-cyan);
            border-color: var(--neon-cyan);
        }

        .calc-key.eq {
            background: var(--neon-green);
            color: black;
            border-color: var(--neon-green);
            font-weight: 900;
        }

        .calc-key.eq:hover {
            box-shadow: 0 0 15px var(--neon-green);
        }

        .calc-key.cl {
            background: #300;
            color: #f55;
            border-color: #f55;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: #0f0;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #00cc00;
        }

        h2,
        h3 {
            letter-spacing: 1px;
        }

        label {
            color: #aaa;
            font-weight: bold;
            font-size: 0.8rem;
            display: block;
            margin-bottom: 4px;
        }

        .math-step {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #333;
        }

        .math-step:last-child {
            border-bottom: none;
        }

        .math-highlight {
            color: var(--neon-yellow);
            font-weight: bold;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .loading-spinner {
            border: 3px solid #333;
            border-top: 3px solid var(--neon-green);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error-message {
            background: rgba(50, 0, 0, 0.8);
            border-left: 4px solid #f55;
            color: #faa;
            padding: 10px;
            margin-top: 10px;
            border-radius: 2px;
        }

        .success-message {
            background: rgba(0, 50, 0, 0.8);
            border-left: 4px solid var(--neon-green);
            color: #afa;
            padding: 10px;
            margin-top: 10px;
            border-radius: 2px;
        }

        .matrix-cell {
            width: 50px;
            height: 40px;
            text-align: center;
            background: #0a0a0a;
            border: 1px solid #333;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .matrix-cell:focus {
            border-color: var(--neon-cyan);
            background: #001515;
        }

        @media (max-width: 768px) {
            .calc-key {
                font-size: 0.9rem;
                padding: 12px;
            }

            h1 {
                font-size: 1.2rem !important;
            }
        }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden text-sm md:text-base">

    <canvas id="matrix-canvas"></canvas>
    <div class="scanlines"></div>

    <header
        class="p-3 border-b border-green-900 bg-black bg-opacity-90 flex justify-between items-center z-20 shadow-[0_5px_20px_rgba(0,255,0,0.1)]">
        <div class="flex items-center gap-3">
            <i class="fas fa-microchip text-2xl text-green-400 animate-pulse"></i>
            <div>
                <h1 class="text-xl md:text-2xl font-bold tracking-widest text-white glowing-text">ENG_CALC_ULTIMATE</h1>
                <div class="text-[10px] text-cyan-400 tracking-[0.2em] font-bold">F.Y. B.TECH SUITE v4.0</div>
            </div>
        </div>
        <div class="flex gap-4 items-center">
            <button onclick="downloadPDF()" class="cyber-btn text-xs hidden md:flex">
                <i class="fas fa-file-pdf"></i> SAVE PDF
            </button>
            <div class="text-right hidden md:block">
                <div id="clock" class="text-green-500 font-mono font-bold">00:00:00</div>
                <div class="text-[10px] text-gray-400">SYSTEM ONLINE</div>
            </div>
        </div>
    </header>

    <nav
        class="flex space-x-1 bg-black bg-opacity-95 p-1 z-20 border-b border-gray-800 overflow-x-auto shrink-0 no-scrollbar">
        <button onclick="switchTab('sci')" class="tab-btn active px-4 py-3 whitespace-nowrap" id="btn-sci"><i
                class="fas fa-calculator"></i> SCI-CALC</button>
        <button onclick="switchTab('system')" class="tab-btn px-4 py-3 whitespace-nowrap" id="btn-system"><i
                class="fas fa-layer-group"></i> LIN-SYS</button>
        <button onclick="switchTab('matrix')" class="tab-btn px-4 py-3 whitespace-nowrap" id="btn-matrix"><i
                class="fas fa-border-all"></i> MATRIX</button>
        <button onclick="switchTab('vector')" class="tab-btn px-4 py-3 whitespace-nowrap" id="btn-vector"><i
                class="fas fa-location-arrow"></i> VECTORS</button>
        <button onclick="switchTab('geom')" class="tab-btn px-4 py-3 whitespace-nowrap" id="btn-geom"><i
                class="fas fa-shapes"></i> GEOM/POLY</button>
        <button onclick="switchTab('calc')" class="tab-btn px-4 py-3 whitespace-nowrap" id="btn-calc"><i
                class="fas fa-infinity"></i> CALCULUS</button>
        <button onclick="switchTab('diffeq')" class="tab-btn px-4 py-3 whitespace-nowrap" id="btn-diffeq"><i
                class="fas fa-wave-square"></i> DIFF-EQ</button>
        <button onclick="switchTab('grader')" class="tab-btn px-4 py-3 whitespace-nowrap text-pink-400"
            id="btn-grader"><i class="fas fa-graduation-cap"></i> GRADER</button>
        <button onclick="switchTab('grapher')" class="tab-btn px-4 py-3 whitespace-nowrap" id="btn-grapher"><i
                class="fas fa-chart-line"></i> GRAPHER</button>
        <button onclick="switchTab('guide')" class="tab-btn px-4 py-3 whitespace-nowrap text-yellow-400"
            id="btn-guide"><i class="fas fa-question-circle"></i> GUIDE</button>
    </nav>

    <div class="flex-grow overflow-y-auto z-10 relative flex flex-col w-full scroll-smooth">
        <main id="main-content" class="flex-grow p-4 md:p-6 w-full max-w-7xl mx-auto">

            <div id="tab-sci" class="tab-content max-w-md mx-auto glass-panel p-4">
                <input type="text" id="sci-screen"
                    class="w-full h-16 text-right text-2xl mb-4 bg-black text-green-400 font-mono border-green-500"
                    placeholder="0" onkeydown="sciKeyHandler(event)">
                <div class="grid grid-cols-5 gap-2">
                    <button class="calc-key op" onclick="sciIn('sin(')">sin</button>
                    <button class="calc-key op" onclick="sciIn('cos(')">cos</button>
                    <button class="calc-key op" onclick="sciIn('tan(')">tan</button>
                    <button class="calc-key op" onclick="sciIn('log(')">log</button>
                    <button class="calc-key cl" onclick="sciClear()">AC</button>

                    <button class="calc-key op" onclick="sciIn('ln(')">ln</button>
                    <button class="calc-key op" onclick="sciIn('sqrt(')">√</button>
                    <button class="calc-key op" onclick="sciIn('^')">^</button>
                    <button class="calc-key" onclick="sciIn('(')">(</button>
                    <button class="calc-key" onclick="sciIn(')')">)</button>

                    <button class="calc-key" onclick="sciIn('7')">7</button>
                    <button class="calc-key" onclick="sciIn('8')">8</button>
                    <button class="calc-key" onclick="sciIn('9')">9</button>
                    <button class="calc-key op" onclick="sciIn('/')">÷</button>
                    <button class="calc-key" onclick="sciIn('pi')">π</button>

                    <button class="calc-key" onclick="sciIn('4')">4</button>
                    <button class="calc-key" onclick="sciIn('5')">5</button>
                    <button class="calc-key" onclick="sciIn('6')">6</button>
                    <button class="calc-key op" onclick="sciIn('*')">×</button>
                    <button class="calc-key" style="color:#f55;border-color:#f55;" onclick="sciBackspace()">⌫</button>

                    <button class="calc-key" onclick="sciIn('1')">1</button>
                    <button class="calc-key" onclick="sciIn('2')">2</button>
                    <button class="calc-key" onclick="sciIn('3')">3</button>
                    <button class="calc-key op" onclick="sciIn('-')">-</button>
                    <button class="calc-key op" onclick="sciIn('+')">+</button>

                    <button class="calc-key" onclick="sciIn('0')" style="grid-column: span 2;">0</button>
                    <button class="calc-key" onclick="sciIn('.')">.</button>
                    <button class="calc-key" onclick="sciIn('e')">e</button>
                    <button class="calc-key eq" onclick="sciCalc()">=</button>
                </div>
                <div id="sci-history" class="mt-4 text-xs text-gray-500"></div>
            </div>

            <div id="tab-system" class="tab-content hidden max-w-5xl mx-auto glass-panel p-6">
                <h2 class="text-xl text-cyan-400 mb-4 border-b border-gray-700 pb-2">Linear System Solver (AX = B)</h2>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div><label>Variables (n)</label><input type="number" id="sys-cols" value="3" min="1" max="10"
                            class="w-full"></div>
                    <div><label>Equations (m)</label><input type="number" id="sys-rows" value="3" min="1" max="10"
                            class="w-full"></div>
                </div>
                <button onclick="generateSystemGrid()" class="cyber-btn w-full mb-4"><i class="fas fa-table"></i>
                    GENERATE GRID</button>
                <div id="system-input-area" class="hidden">
                    <div id="system-grid-container" class="flex gap-4 justify-center mb-4 overflow-x-auto"></div>
                    <div class="flex gap-2">
                        <button onclick="solveSystem()" class="cyber-btn flex-grow"><i class="fas fa-play"></i>
                            SOLVE</button>
                        <button onclick="clearSystem()" class="cyber-btn cyber-btn-warning"><i class="fas fa-trash"></i>
                            RESET</button>
                    </div>
                </div>
                <div id="system-result" class="result-box hidden"></div>
            </div>

            <div id="tab-matrix" class="tab-content hidden max-w-6xl mx-auto glass-panel p-6">
                <h2 class="text-xl text-cyan-400 mb-4 border-b border-gray-700 pb-2">Matrix Operations</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-green-400 font-bold mb-2">Matrix A</h3>
                        <div class="flex gap-2 mb-2">
                            <input type="number" id="matA-rows" value="3" min="1" max="8" class="w-16">
                            <span class="pt-2">×</span>
                            <input type="number" id="matA-cols" value="3" min="1" max="8" class="w-16">
                            <button onclick="genMatrixGrid('A')" class="cyber-btn text-xs py-1">SET</button>
                        </div>
                        <div id="grid-A-container"
                            class="overflow-x-auto p-2 border border-green-900 min-h-[100px] flex items-center justify-center bg-black bg-opacity-50">
                        </div>
                    </div>
                    <div>
                        <h3 class="text-cyan-400 font-bold mb-2">Matrix B</h3>
                        <div class="flex gap-2 mb-2">
                            <input type="number" id="matB-rows" value="3" min="1" max="8" class="w-16">
                            <span class="pt-2">×</span>
                            <input type="number" id="matB-cols" value="3" min="1" max="8" class="w-16">
                            <button onclick="genMatrixGrid('B')"
                                class="cyber-btn cyber-btn-secondary text-xs py-1">SET</button>
                        </div>
                        <div id="grid-B-container"
                            class="overflow-x-auto p-2 border border-cyan-900 min-h-[100px] flex items-center justify-center bg-black bg-opacity-50">
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <h4 class="text-gray-400 text-xs mb-2">OPERATIONS</h4>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button onclick="matBinaryOp('add')" class="cyber-btn text-xs">A + B</button>
                        <button onclick="matBinaryOp('sub')" class="cyber-btn text-xs">A - B</button>
                        <button onclick="matBinaryOp('mul')" class="cyber-btn text-xs">A × B</button>
                        <button onclick="matUnaryOp('det')"
                            class="cyber-btn cyber-btn-secondary text-xs">Det(A)</button>
                        <button onclick="matUnaryOp('inv')"
                            class="cyber-btn cyber-btn-secondary text-xs">Inv(A)</button>
                        <button onclick="matUnaryOp('transpose')"
                            class="cyber-btn cyber-btn-secondary text-xs">Transpose(A)</button>
                        <button onclick="matUnaryOp('rank')"
                            class="cyber-btn cyber-btn-secondary text-xs">Rank(A)</button>
                        <button onclick="solveEigen()"
                            class="cyber-btn cyber-btn-accent text-xs">Eigenvalues/vectors</button>
                    </div>
                </div>
                <div id="mat-result" class="result-box hidden"></div>
            </div>

            <div id="tab-vector" class="tab-content hidden max-w-4xl mx-auto glass-panel p-6">
                <h2 class="text-xl text-cyan-400 mb-4">Vector Calculus (3D)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="p-4 border border-green-900 bg-black bg-opacity-30">
                        <h3 class="text-green-400 mb-2 font-bold">Vector A = ai + bj + ck</h3>
                        <div class="flex gap-2">
                            <div class="flex-1">
                                <label>i</label>
                                <input type="number" id="vecA-i" placeholder="0" value="1" class="w-full">
                            </div>
                            <div class="flex-1">
                                <label>j</label>
                                <input type="number" id="vecA-j" placeholder="0" value="2" class="w-full">
                            </div>
                            <div class="flex-1">
                                <label>k</label>
                                <input type="number" id="vecA-k" placeholder="0" value="3" class="w-full">
                            </div>
                        </div>
                    </div>
                    <div class="p-4 border border-cyan-900 bg-black bg-opacity-30">
                        <h3 class="text-cyan-400 mb-2 font-bold">Vector B = ai + bj + ck</h3>
                        <div class="flex gap-2">
                            <div class="flex-1">
                                <label>i</label>
                                <input type="number" id="vecB-i" placeholder="0" value="4" class="w-full">
                            </div>
                            <div class="flex-1">
                                <label>j</label>
                                <input type="number" id="vecB-j" placeholder="0" value="5" class="w-full">
                            </div>
                            <div class="flex-1">
                                <label>k</label>
                                <input type="number" id="vecB-k" placeholder="0" value="6" class="w-full">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <button onclick="vecCalc('dot')" class="cyber-btn">A · B (Dot)</button>
                    <button onclick="vecCalc('cross')" class="cyber-btn">A × B (Cross)</button>
                    <button onclick="vecCalc('mag')" class="cyber-btn">|A| & |B|</button>
                    <button onclick="vecCalc('angle')" class="cyber-btn">Angle θ</button>
                </div>
                <div id="vec-result" class="result-box hidden"></div>
            </div>

            <div id="tab-geom" class="tab-content hidden max-w-5xl mx-auto glass-panel p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-green-400 font-bold mb-3 border-b border-gray-700">Polynomial Solver</h3>
                        <div class="mb-2">
                            <label>Equation (e.g., x^2 - 5*x + 6)</label>
                            <input type="text" id="poly-eq" value="x^2 - 5*x + 6" class="w-full">
                        </div>
                        <button onclick="solvePoly()" class="cyber-btn w-full mb-2"><i class="fas fa-calculator"></i>
                            Find Roots</button>
                        <div id="poly-result"
                            class="text-cyan-300 font-mono text-sm min-h-[40px] p-2 bg-black bg-opacity-50 border border-gray-800">
                        </div>
                    </div>
                    <div>
                        <h3 class="text-cyan-400 font-bold mb-3 border-b border-gray-700">Coordinate Geometry (2D)</h3>
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <div><label>x₁</label><input type="number" id="geo-x1" placeholder="x1" value="0"
                                    class="w-full"></div>
                            <div><label>y₁</label><input type="number" id="geo-y1" placeholder="y1" value="0"
                                    class="w-full"></div>
                            <div><label>x₂</label><input type="number" id="geo-x2" placeholder="x2" value="3"
                                    class="w-full"></div>
                            <div><label>y₂</label><input type="number" id="geo-y2" placeholder="y2" value="4"
                                    class="w-full"></div>
                        </div>
                        <div class="mb-2 p-2 border border-gray-800 bg-black bg-opacity-30">
                            <label class="text-yellow-400">Section Formula (divides in ratio m:n)</label>
                            <div class="flex gap-2 mt-1">
                                <div class="flex-1"><label>m</label><input type="number" id="geo-m" value="1"
                                        class="w-full"></div>
                                <div class="flex-1"><label>n</label><input type="number" id="geo-n" value="1"
                                        class="w-full"></div>
                            </div>
                        </div>
                        <button onclick="solveGeom()" class="cyber-btn w-full mb-2"><i class="fas fa-ruler"></i>
                            Calculate All</button>
                        <div id="geo-result"
                            class="text-green-300 font-mono text-sm min-h-[40px] p-2 bg-black bg-opacity-50 border border-gray-800">
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-6">
                    <div class="p-4 border border-gray-800 bg-black bg-opacity-50">
                        <h3 class="text-yellow-400 font-bold mb-2">Rectangular → Polar</h3>
                        <div class="flex gap-2 items-end mb-2">
                            <div class="flex-grow"><label>x</label><input type="number" id="rp-x" value="1"
                                    class="w-full"></div>
                            <div class="flex-grow"><label>y</label><input type="number" id="rp-y" value="1"
                                    class="w-full"></div>
                        </div>
                        <button onclick="rectToPolar()" class="cyber-btn w-full text-xs">Convert</button>
                        <div id="rp-result" class="mt-2 font-mono text-white text-xs min-h-[30px]"></div>
                    </div>
                    <div class="p-4 border border-gray-800 bg-black bg-opacity-50">
                        <h3 class="text-yellow-400 font-bold mb-2">Polar → Rectangular</h3>
                        <div class="flex gap-2 items-end mb-2">
                            <div class="flex-grow"><label>r</label><input type="number" id="pr-r" value="1.41"
                                    class="w-full"></div>
                            <div class="flex-grow"><label>θ (deg)</label><input type="number" id="pr-theta" value="45"
                                    class="w-full"></div>
                        </div>
                        <button onclick="polarToRect()" class="cyber-btn w-full text-xs">Convert</button>
                        <div id="pr-result" class="mt-2 font-mono text-white text-xs min-h-[30px]"></div>
                    </div>
                    <div class="p-4 border border-gray-800 bg-black bg-opacity-50">
                        <h3 class="text-yellow-400 font-bold mb-2">Angle Converter</h3>
                        <div class="mb-2">
                            <label>Value</label>
                            <input type="number" id="angle-val" value="180" class="w-full">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="convertAngle('d2r')" class="cyber-btn text-xs">Deg → Rad</button>
                            <button onclick="convertAngle('r2d')" class="cyber-btn text-xs">Rad → Deg</button>
                        </div>
                        <div id="angle-result" class="mt-2 font-mono text-white text-xs min-h-[20px]"></div>
                    </div>
                </div>
            </div>

            <div id="tab-calc" class="tab-content hidden max-w-5xl mx-auto glass-panel p-6">
                <h2 class="text-xl text-cyan-400 mb-4 border-b border-gray-700 pb-2">
                    <i class="fas fa-infinity"></i> Calculus Suite
                </h2>

                <!-- Sub-tabs for Calculus -->
                <div class="flex space-x-1 mb-6 overflow-x-auto no-scrollbar border-b border-gray-800 pb-1">
                    <button onclick="switchCalcSub('diff')" id="btn-calc-diff"
                        class="calc-sub-btn px-4 py-2 text-xs font-bold uppercase tracking-wider border-b-2 border-green-400 text-green-400 bg-green-900 bg-opacity-20 whitespace-nowrap">
                        <i class="fas fa-chart-line"></i> Differentiation
                    </button>
                    <button onclick="switchCalcSub('limit')" id="btn-calc-limit"
                        class="calc-sub-btn px-4 py-2 text-xs font-bold uppercase tracking-wider border-b-2 border-transparent text-gray-400 whitespace-nowrap">
                        <i class="fas fa-arrows-alt-h"></i> Limits
                    </button>
                    <button onclick="switchCalcSub('indef')" id="btn-calc-indef"
                        class="calc-sub-btn px-4 py-2 text-xs font-bold uppercase tracking-wider border-b-2 border-transparent text-gray-400 whitespace-nowrap">
                        <i class="fas fa-wave-square"></i> Indefinite Integral
                    </button>
                    <button onclick="switchCalcSub('def')" id="btn-calc-def"
                        class="calc-sub-btn px-4 py-2 text-xs font-bold uppercase tracking-wider border-b-2 border-transparent text-gray-400 whitespace-nowrap">
                        <i class="fas fa-ruler-horizontal"></i> Definite Integral
                    </button>
                </div>

                <!-- ===== SUB-TAB 1: DIFFERENTIATION ===== -->
                <div id="calc-sub-diff" class="calc-sub-content">
                    <h3 class="text-green-400 font-bold mb-3">Differentiation — d/dx f(x)</h3>

                    <!-- Mode toggle: Symbolic vs At a Point -->
                    <div class="flex gap-2 mb-4">
                        <button onclick="setDiffMode('symbolic')" id="btn-diff-symbolic"
                            class="flex-1 py-2 px-3 text-xs font-bold border border-green-500 bg-green-900 bg-opacity-40 text-green-300">
                            <i class="fas fa-superscript"></i> Symbolic (Variables Only)
                        </button>
                        <button onclick="setDiffMode('numeric')" id="btn-diff-numeric"
                            class="flex-1 py-2 px-3 text-xs font-bold border border-gray-600 text-gray-400">
                            <i class="fas fa-hashtag"></i> Evaluate at a Point
                        </button>
                    </div>

                    <div class="mb-3">
                        <label>Function f(x)</label>
                        <input type="text" id="diff-f" value="x^3 + 2*x^2 - 5*x + 1" class="w-full"
                            placeholder="e.g., x^3, sin(x), exp(x)">
                    </div>

                    <div class="mb-3">
                        <label>Order of Derivative</label>
                        <select id="diff-order" class="w-full">
                            <option value="1">1st Derivative (f')</option>
                            <option value="2">2nd Derivative (f'')</option>
                            <option value="3">3rd Derivative (f''')</option>
                        </select>
                    </div>

                    <!-- Numeric mode: point input -->
                    <div id="diff-point-input" class="mb-3 hidden">
                        <label>Evaluate at x = </label>
                        <input type="text" id="diff-point" value="2" class="w-full" placeholder="e.g., 0, 1, pi, 2.5">
                    </div>

                    <button onclick="calcDifferentiation()" class="cyber-btn w-full">
                        <i class="fas fa-calculator"></i> DIFFERENTIATE
                    </button>
                    <div id="diff-result" class="result-box hidden"></div>
                </div>

                <!-- ===== SUB-TAB 2: LIMITS ===== -->
                <div id="calc-sub-limit" class="calc-sub-content hidden">
                    <h3 class="text-cyan-400 font-bold mb-3">Limits — lim f(x) as x → a</h3>

                    <div class="mb-3">
                        <label>Function f(x)</label>
                        <input type="text" id="limit-f" value="(sin(x))/x" class="w-full"
                            placeholder="e.g., sin(x)/x, (x^2-1)/(x-1)">
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div>
                            <label>x approaches (a)</label>
                            <input type="text" id="limit-a" value="0" class="w-full"
                                placeholder="e.g., 0, pi, infinity">
                        </div>
                        <div>
                            <label>Direction</label>
                            <select id="limit-dir" class="w-full">
                                <option value="both">Both sides (default)</option>
                                <option value="left">From left (x → a⁻)</option>
                                <option value="right">From right (x → a⁺)</option>
                            </select>
                        </div>
                    </div>

                    <button onclick="calcLimitNew()" class="cyber-btn cyber-btn-secondary w-full">
                        <i class="fas fa-arrows-alt-h"></i> FIND LIMIT
                    </button>
                    <div id="limit-result" class="result-box hidden"></div>
                </div>

                <!-- ===== SUB-TAB 3: INDEFINITE INTEGRAL ===== -->
                <div id="calc-sub-indef" class="calc-sub-content hidden">
                    <h3 class="text-pink-400 font-bold mb-3">Indefinite Integral — ∫ f(x) dx</h3>

                    <div class="mb-3">
                        <label>Function f(x)</label>
                        <input type="text" id="indef-f" value="x^2 * cos(x)" class="w-full"
                            placeholder="e.g., x^2, sin(x), exp(x)*x">
                    </div>

                    <div class="mb-3">
                        <label>Variable of Integration</label>
                        <input type="text" id="indef-var" value="x" class="w-24" placeholder="x">
                    </div>

                    <button onclick="calcIndefiniteIntegral()" class="cyber-btn cyber-btn-accent w-full">
                        <i class="fas fa-wave-square"></i> INTEGRATE
                    </button>
                    <div id="indef-result" class="result-box hidden"></div>
                </div>

                <!-- ===== SUB-TAB 4: DEFINITE INTEGRAL ===== -->
                <div id="calc-sub-def" class="calc-sub-content hidden">
                    <h3 class="text-yellow-400 font-bold mb-3">Definite Integral — ∫ₐᵇ f(x) dx</h3>

                    <div class="mb-3">
                        <label>Function f(x)</label>
                        <input type="text" id="def-f" value="x^2" class="w-full"
                            placeholder="e.g., x^2, sin(x), exp(x)">
                    </div>

                    <div class="grid grid-cols-3 gap-4 mb-3">
                        <div>
                            <label>Lower bound (a)</label>
                            <input type="text" id="def-a" value="0" class="w-full" placeholder="e.g., 0">
                        </div>
                        <div>
                            <label>Upper bound (b)</label>
                            <input type="text" id="def-b" value="1" class="w-full" placeholder="e.g., 1, pi">
                        </div>
                        <div>
                            <label>Variable</label>
                            <input type="text" id="def-var" value="x" class="w-full" placeholder="x">
                        </div>
                    </div>

                    <button onclick="calcDefiniteIntegral()" class="cyber-btn w-full text-yellow-400 border-yellow-400">
                        <i class="fas fa-ruler-horizontal"></i> EVALUATE INTEGRAL
                    </button>
                    <div id="def-result" class="result-box hidden"></div>
                </div>
            </div>

            <div id="tab-diffeq" class="tab-content hidden max-w-6xl mx-auto glass-panel p-6">
                <h2 class="text-xl text-cyan-400 mb-4">Differential Equations</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <div class="p-4 border border-green-900 bg-black bg-opacity-30">
                        <h3 class="text-sm font-bold text-green-400 mb-2">Exact DE (Mdx + Ndy = 0)</h3>
                        <div class="mb-2">
                            <label>M(x,y)</label>
                            <input type="text" id="de-m" placeholder="e.g., 2*x*y" value="2*x*y" class="w-full">
                        </div>
                        <div class="mb-2">
                            <label>N(x,y)</label>
                            <input type="text" id="de-n" placeholder="e.g., x^2" value="x^2" class="w-full">
                        </div>
                        <button onclick="solveExactDE()" class="cyber-btn w-full">SOLVE</button>
                        <div id="de-exact-res" class="mt-2 text-xs font-mono text-cyan-300 max-h-40 overflow-y-auto">
                        </div>
                    </div>

                    <div class="p-4 border border-cyan-900 bg-black bg-opacity-30">
                        <h3 class="text-sm font-bold text-cyan-400 mb-2">Linear DE (dy/dx + Py = Q)</h3>
                        <div class="mb-2">
                            <label>P(x)</label>
                            <input type="text" id="de-p" placeholder="e.g., 1/x" value="1/x" class="w-full">
                        </div>
                        <div class="mb-2">
                            <label>Q(x)</label>
                            <input type="text" id="de-q" placeholder="e.g., x^2" value="x^2" class="w-full">
                        </div>
                        <button onclick="solveLinearDE()" class="cyber-btn w-full cyber-btn-secondary">SOLVE</button>
                        <div id="de-linear-res" class="mt-2 text-xs font-mono text-green-300 max-h-40 overflow-y-auto">
                        </div>
                    </div>

                    <div class="p-4 border border-yellow-900 bg-black bg-opacity-30">
                        <h3 class="text-sm font-bold text-yellow-400 mb-2">Higher Order Linear DE</h3>
                        <div class="mb-2">
                            <label>Auxiliary Equation (in D, e.g., D^2 - 5*D + 6)</label>
                            <input type="text" id="de-aux" value="D^2 - 5*D + 6" class="w-full">
                        </div>
                        <div class="mb-2">
                            <label>RHS Function X (e.g., exp(x), sin(x))</label>
                            <input type="text" id="de-rhs" value="exp(x)" class="w-full">
                        </div>
                        <button onclick="solveLinearHigherOrder()"
                            class="cyber-btn w-full text-yellow-400 border-yellow-400">SOLVE</button>
                        <div id="de-ho-res" class="mt-2 text-xs font-mono text-yellow-200 max-h-40 overflow-y-auto">
                        </div>
                    </div>

                    <div class="p-4 border border-pink-900 bg-black bg-opacity-30">
                        <h3 class="text-sm font-bold text-pink-400 mb-2">Orthogonal Trajectories</h3>

                        <div class="flex gap-2 mb-2 text-xs">
                            <button onclick="setOrthoMode('eq')" id="btn-ortho-eq"
                                class="flex-1 py-1 px-2 border border-pink-500 bg-pink-900 text-white">From
                                Equation</button>
                            <button onclick="setOrthoMode('slope')" id="btn-ortho-slope"
                                class="flex-1 py-1 px-2 border border-gray-600 text-gray-400">From Slope</button>
                        </div>

                        <div id="ortho-mode-eq">
                            <label>Family of Curves (with constant 'c')</label>
                            <input type="text" id="ot-eq" value="x^2 + y^2 = c" class="w-full mb-2"
                                placeholder="e.g., y = c*x^2">
                        </div>

                        <div id="ortho-mode-slope" class="hidden">
                            <label>Slope dy/dx = f(x,y)</label>
                            <input type="text" id="ot-slope" value="-x/y" class="w-full mb-2" placeholder="e.g., -x/y">
                        </div>

                        <button onclick="solveOrthogonal()" class="cyber-btn w-full text-pink-400 border-pink-400">FIND
                            TRAJECTORY</button>
                        <div id="ot-res" class="mt-2 text-xs font-mono text-pink-200 max-h-40 overflow-y-auto"></div>
                    </div>
                </div>
            </div>

            <div id="tab-grader" class="tab-content hidden max-w-2xl mx-auto glass-panel p-6">
                <h2 class="text-xl text-pink-400 mb-4 border-b border-pink-900 pb-2"><i
                        class="fas fa-graduation-cap"></i> SGPA & Grade Calculator</h2>

                <!-- Quick Single-Subject Grade -->
                <div class="mb-6 p-4 border border-gray-800 bg-black bg-opacity-30">
                    <h3 class="text-green-400 font-bold mb-3 text-sm">Quick Single-Subject Grade</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label>Total Marks</label>
                            <input type="number" id="grade-total" value="100" min="1" class="w-full">
                        </div>
                        <div>
                            <label>Obtained Marks</label>
                            <input type="number" id="grade-obt" value="85" min="0" class="w-full">
                        </div>
                    </div>
                    <button onclick="calcGrade()" class="cyber-btn w-full mt-3 text-pink-400 border-pink-400">
                        <i class="fas fa-calculator"></i> CALCULATE GRADE
                    </button>
                    <div id="grade-result" class="result-box hidden border-pink-500"></div>
                </div>

                <!-- Multi-Subject SGPA Calculator -->
                <div class="p-4 border border-pink-900 bg-black bg-opacity-30">
                    <h3 class="text-pink-400 font-bold mb-3 text-sm">SGPA Calculator (Multiple Subjects)</h3>
                    <div class="flex gap-2 mb-3">
                        <div class="flex-1">
                            <label>Number of Subjects</label>
                            <input type="number" id="sgpa-count" value="6" min="1" max="15" class="w-full">
                        </div>
                        <button onclick="generateSGPAGrid()" class="cyber-btn text-xs self-end"><i
                                class="fas fa-table"></i> SET</button>
                    </div>
                    <div id="sgpa-grid" class="space-y-2 mb-3 max-h-[300px] overflow-y-auto"></div>
                    <button onclick="calcSGPA()" class="cyber-btn w-full text-yellow-400 border-yellow-400">
                        <i class="fas fa-award"></i> CALCULATE SGPA
                    </button>
                    <div id="sgpa-result" class="result-box hidden"></div>
                </div>

                <div class="mt-4 p-3 border border-gray-800 bg-black bg-opacity-50">
                    <h3 class="text-sm text-gray-400 mb-2">Grade Scale Reference</h3>
                    <div class="text-xs grid grid-cols-2 gap-1 text-gray-500">
                        <div>• O: 95-100% (10 pts)</div>
                        <div>• A+: 90-94% (9 pts)</div>
                        <div>• A: 80-89% (8 pts)</div>
                        <div>• B+: 70-79% (7 pts)</div>
                        <div>• B: 60-69% (6 pts)</div>
                        <div>• C: 50-59% (5 pts)</div>
                        <div>• P: 40-49% (4 pts)</div>
                        <div>• F: Below 40% (0 pts)</div>
                    </div>
                </div>
            </div>

            <div id="tab-grapher" class="tab-content hidden max-w-5xl mx-auto glass-panel p-6 h-full flex flex-col">
                <h2 class="text-xl text-cyan-400 mb-4">Multi-Function Plotter</h2>
                <div class="space-y-2 mb-3">
                    <div class="flex gap-2 items-end">
                        <div class="flex-grow">
                            <label><span class="text-green-400 font-bold">●</span> f₁(x)</label>
                            <input type="text" id="graph-func" value="sin(x)*x" class="w-full"
                                placeholder="e.g., x^2, sin(x)" style="border-left-color:#0f0;">
                        </div>
                    </div>
                    <div class="flex gap-2 items-end">
                        <div class="flex-grow">
                            <label><span class="text-cyan-400 font-bold">●</span> f₂(x) <span
                                    class="text-gray-600 text-xs">(optional)</span></label>
                            <input type="text" id="graph-func2" value="" class="w-full" placeholder="e.g., cos(x)*x"
                                style="border-left-color:#0ff;">
                        </div>
                    </div>
                    <div class="flex gap-2 items-end">
                        <div class="flex-grow">
                            <label><span class="text-pink-400 font-bold">●</span> f₃(x) <span
                                    class="text-gray-600 text-xs">(optional)</span></label>
                            <input type="text" id="graph-func3" value="" class="w-full" placeholder="e.g., x^2/10"
                                style="border-left-color:#f0f;">
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div>
                        <label>X Min</label>
                        <input type="number" id="x-min" value="-10" class="w-full">
                    </div>
                    <div>
                        <label>X Max</label>
                        <input type="number" id="x-max" value="10" class="w-full">
                    </div>
                    <button onclick="plotGraph()" class="cyber-btn self-end"><i class="fas fa-chart-area"></i>
                        PLOT</button>
                </div>
                <div id="plot-area" class="w-full bg-black border border-gray-800 flex-grow rounded"
                    style="min-height: 400px;"></div>
            </div>

            <div id="tab-guide" class="tab-content hidden max-w-4xl mx-auto glass-panel p-8">
                <h2 class="text-2xl text-yellow-400 mb-6 border-b border-yellow-700 pb-2">
                    <i class="fas fa-book"></i> USER MANUAL
                </h2>
                <div class="space-y-6 text-gray-300 text-sm">
                    <div class="p-4 border border-green-900 bg-black bg-opacity-30">
                        <p class="text-green-400 font-bold mb-2"><i class="fas fa-calculator"></i> SCI-CALC</p>
                        <p>Full-featured scientific calculator with trigonometric functions, logarithms, and powers. Use
                            'e' for Euler's number (2.718...) and 'pi' for π (3.14...).</p>
                    </div>

                    <div class="p-4 border border-cyan-900 bg-black bg-opacity-30">
                        <p class="text-cyan-400 font-bold mb-2"><i class="fas fa-layer-group"></i> LIN-SYS</p>
                        <p>Solves systems of linear equations (AX=B). Enter dimensions, generate grid, fill coefficient
                            matrix A and constant vector B. Automatically checks rank and solvability.</p>
                    </div>

                    <div class="p-4 border border-green-900 bg-black bg-opacity-30">
                        <p class="text-green-400 font-bold mb-2"><i class="fas fa-border-all"></i> MATRIX</p>
                        <p>Complete matrix operations: Addition, Subtraction, Multiplication, Determinant, Inverse,
                            Transpose, Rank (using RREF), and Eigenvalues/Eigenvectors. Supports up to 8×8 matrices.</p>
                    </div>

                    <div class="p-4 border border-cyan-900 bg-black bg-opacity-30">
                        <p class="text-cyan-400 font-bold mb-2"><i class="fas fa-location-arrow"></i> VECTORS</p>
                        <p>3D vector operations: Dot product (scalar), Cross product (vector), Magnitude calculation,
                            and Angle between vectors.</p>
                    </div>

                    <div class="p-4 border border-green-900 bg-black bg-opacity-30">
                        <p class="text-green-400 font-bold mb-2"><i class="fas fa-shapes"></i> GEOM/POLY</p>
                        <p>Polynomial root finding. 2D coordinate geometry: distance, slope, midpoint, line equation,
                            and section formula. Also includes Rectangular↔Polar conversion and Degree↔Radian angle
                            conversion.</p>
                    </div>

                    <div class="p-4 border border-cyan-900 bg-black bg-opacity-30">
                        <p class="text-cyan-400 font-bold mb-2"><i class="fas fa-infinity"></i> CALCULUS</p>
                        <p><strong>Differentiation:</strong> Symbolic derivatives (1st-3rd order) with optional
                            evaluation at a point.<br>
                            <strong>Limits:</strong> Two-sided or one-sided limits with numerical verification.<br>
                            <strong>Indefinite Integral:</strong> Symbolic integration with verification.<br>
                            <strong>Definite Integral:</strong> Step-by-step evaluation with exact & decimal result.
                        </p>
                    </div>

                    <div class="p-4 border border-yellow-900 bg-black bg-opacity-30">
                        <p class="text-yellow-400 font-bold mb-2"><i class="fas fa-wave-square"></i> DIFF-EQ</p>
                        <p><strong>Exact DE:</strong> Checks exactness condition (∂M/∂y = ∂N/∂x) and solves if
                            exact.<br>
                            <strong>Linear DE:</strong> Finds integrating factor and general solution for dy/dx + Py =
                            Q.<br>
                            <strong>Higher Order:</strong> Solves auxiliary equation to find complementary function
                            (CF).<br>
                            <strong>Orthogonal Trajectories:</strong> Enter family equation (e.g., x²+y²=c) or slope to
                            find orthogonal curves.
                        </p>
                    </div>

                    <div class="p-4 border border-pink-900 bg-black bg-opacity-30">
                        <p class="text-pink-400 font-bold mb-2"><i class="fas fa-graduation-cap"></i> GRADER</p>
                        <p>Calculates percentage, grade letter, and grade points based on 10-point scale. Useful for
                            quick CGPA estimation.</p>
                    </div>

                    <div class="p-4 border border-green-900 bg-black bg-opacity-30">
                        <p class="text-green-400 font-bold mb-2"><i class="fas fa-chart-line"></i> GRAPHER</p>
                        <p>Plots any mathematical function over custom range. Handles discontinuities gracefully. Use
                            standard math notation: x^2, sin(x), exp(x), etc.</p>
                    </div>

                    <div
                        class="mt-6 p-4 bg-gradient-to-r from-green-900 to-cyan-900 bg-opacity-20 border border-green-500 rounded">
                        <p class="text-yellow-300 font-bold mb-2"><i class="fas fa-lightbulb"></i> PRO TIPS</p>
                        <ul class="list-disc list-inside space-y-1 text-xs">
                            <li>Use * for multiplication explicitly (e.g., 2*x not 2x)</li>
                            <li>For powers, use ^ symbol (e.g., x^2, not x²)</li>
                            <li>Trigonometric functions expect radians unless stated otherwise</li>
                            <li>Division by zero and undefined operations are handled gracefully</li>
                            <li>All calculations use high-precision floating-point arithmetic</li>
                        </ul>
                    </div>
                </div>
            </div>

        </main>

        <footer class="border-t border-green-900 bg-black bg-opacity-95 text-center z-10 relative mt-auto py-8">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex flex-col items-center justify-center mb-8">
                    <div class="mb-4 relative group">
                        <div
                            class="absolute -inset-1 bg-gradient-to-r from-green-600 to-cyan-600 rounded-full blur opacity-25 group-hover:opacity-75 transition duration-1000 group-hover:duration-200">
                        </div>
                        <div
                            class="relative h-36 w-36 rounded-full bg-white p-1 flex items-center justify-center border-2 border-green-500 shadow-lg overflow-hidden">
                            <img src="https://www.pccoepune.com/images/pccoe-logo-new.webp" alt="PCCOE Logo"
                                class="h-full w-full object-cover scale-110">
                        </div>
                    </div>
                    <h2
                        class="text-2xl md:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-400 tracking-wider mb-2">
                        PIMPRI CHINCHWAD COLLEGE OF ENGINEERING
                    </h2>
                    <p class="text-green-600 font-mono tracking-[0.3em] text-xs mb-4">NIGDI, PUNE</p>

                    <div
                        class="text-gray-400 text-xs font-bold tracking-wide border-t border-b border-gray-800 py-2 w-full max-w-2xl">
                        DEPARTMENT OF APPLIED SCIENCES AND HUMANITIES
                    </div>

                    <div class="mt-4 px-4 py-2 border border-gray-800 rounded bg-gray-900 text-gray-400 text-xs">
                        <div>FACULTY COORDINATOR: <span class="text-yellow-400 font-bold">MRS. SUJATA BHAMRE MAM</span>
                        </div>
                        <div class="mt-1">LAUC PROJECT <span class="mx-2 text-green-500">|</span> Semester 1 <span
                                class="mx-2 text-green-500">|</span> DIVISION D</div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="student-card p-3 rounded text-left">
                        <div class="text-cyan-400 font-bold text-xs">NIKUNJ NITIN SATPUTE</div>
                        <div class="text-gray-500 text-[10px] font-mono">PRN: 125B1E030</div>
                    </div>
                    <div class="student-card p-3 rounded text-left">
                        <div class="text-cyan-400 font-bold text-xs">KSHITIJ BALASAHEB BHALERAO</div>
                        <div class="text-gray-500 text-[10px] font-mono">PRN: 125B1E016</div>
                    </div>
                    <div class="student-card p-3 rounded text-left">
                        <div class="text-cyan-400 font-bold text-xs">MANISH KISHOR NIMBALKAR</div>
                        <div class="text-gray-500 text-[10px] font-mono">PRN: 125B1E032</div>
                    </div>
                    <div class="student-card p-3 rounded text-left">
                        <div class="text-cyan-400 font-bold text-xs">SARTHAK SANTOSH RATHOD</div>
                        <div class="text-gray-500 text-[10px] font-mono">PRN: 125B1E033</div>
                    </div>
                </div>
                <div class="mt-8 text-gray-600 text-[10px]">
                    <i class="fas fa-code"></i> © 2025 DEPT OF ENGINEERING MATHEMATICS | v4.0 COMPLETE EDITION
                </div>
            </div>
        </footer>
    </div>

    <script>
        // ==================== UTILITY FUNCTIONS ====================

        // FIXED: Added smart input cleaning
        function cleanInput(str) {
            if (!str) return "";
            let clean = str.trim();

            // SMART FIX: Automatically add * between number and variable (e.g., "2x" -> "2*x")
            clean = clean.replace(/(\d)([a-zA-Z])/g, '$1*$2');

            // SMART FIX: Add * between ) and ( (e.g., ")( " -> ")*(")
            clean = clean.replace(/\)\(/g, ')*(');

            return clean;
        }

        function showError(elementId, message) {
            const el = document.getElementById(elementId);
            el.classList.remove('hidden');
            el.innerHTML = `<div class="error-message"><i class="fas fa-exclamation-triangle"></i> ${message}</div>`;
        }

        function showSuccess(elementId, message) {
            const el = document.getElementById(elementId);
            el.classList.remove('hidden');
            el.innerHTML = `<div class="success-message"><i class="fas fa-check-circle"></i> ${message}</div>`;
        }

        function showSpinner(elementId) {
            const el = document.getElementById(elementId);
            el.classList.remove('hidden');
            el.innerHTML = '<div class="loading-spinner"></div>';
        }

        // ==================== PDF GENERATION ====================
        function downloadPDF() {
            // Find which tab is currently active
            const activeTab = document.querySelector('.tab-content:not(.hidden)');

            if (!activeTab) {
                alert("Please select a tab first.");
                return;
            }

            // Options for PDF generation
            const opt = {
                margin: [10, 10],
                filename: 'Engineering_Calculator_Output.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, backgroundColor: '#050505' }, // Keep dark background
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Generate PDF from the active tab only (cleaner result)
            html2pdf().set(opt).from(activeTab).save();
        }

        // ==================== MATRIX RAIN ANIMATION ====================
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const chars = '01ABCDEFXYZ∫∂∇√∞≈≠±×÷';
        const fontSize = 12;
        const cols = Math.floor(canvas.width / fontSize);
        const drops = Array(cols).fill(1);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0,0,0,0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0F0';
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const char = chars.charAt(Math.floor(Math.random() * chars.length));
                ctx.fillText(char, i * fontSize, drops[i] * fontSize);

                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
            requestAnimationFrame(drawMatrix);
        }

        requestAnimationFrame(drawMatrix);

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // ==================== CLOCK ====================
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString();
        }
        setInterval(updateClock, 1000);
        updateClock();

        // ==================== TAB SWITCHING ====================
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + id).classList.remove('hidden');
            document.getElementById('btn-' + id).classList.add('active');

            if (id === 'grapher') {
                setTimeout(() => {
                    const plotArea = document.getElementById('plot-area');
                    if (plotArea && plotArea.data) {
                        Plotly.Plots.resize('plot-area');
                    }
                }, 100);
            }
        }

        // ==================== SCIENTIFIC CALCULATOR ====================
        let calcHistory = [];

        function sciIn(val) {
            const screen = document.getElementById('sci-screen');
            if (screen.value === 'Error') screen.value = '';
            screen.value += val;
        }

        function sciClear() {
            document.getElementById('sci-screen').value = '';
        }

        function sciBackspace() {
            const screen = document.getElementById('sci-screen');
            screen.value = screen.value.slice(0, -1);
        }

        function sciKeyHandler(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                sciCalc();
            }
        }

        function sciCalc() {
            try {
                let exp = document.getElementById('sci-screen').value;
                const original = exp;

                // Convert logarithms correctly
                exp = exp.replace(/\bln\(/g, 'log(');
                exp = exp.replace(/\blog10\(/g, 'log10(');

                const result = math.evaluate(exp);
                document.getElementById('sci-screen').value = result;

                // Add to history
                calcHistory.unshift(`${original} = ${result}`);
                if (calcHistory.length > 5) calcHistory.pop();
                document.getElementById('sci-history').innerHTML = calcHistory.join('<br>');

            } catch (e) {
                document.getElementById('sci-screen').value = 'Error';
                console.error('Calculator Error:', e);
            }
        }

        // ==================== LINEAR SYSTEM SOLVER ====================
        function generateSystemGrid() {
            const rows = parseInt(document.getElementById('sys-rows').value);
            const cols = parseInt(document.getElementById('sys-cols').value);

            if (rows < 1 || cols < 1 || rows > 10 || cols > 10) {
                alert('Dimensions must be between 1 and 10');
                return;
            }

            const container = document.getElementById('system-grid-container');
            let html = '<div class="grid gap-1" style="grid-template-columns:repeat(' + cols + ', 1fr)">';

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    html += `<input id="sysA-${i}-${j}" class="matrix-cell" type="number" placeholder="a${i}${j}" value="0">`;
                }
            }
            html += '</div><div class="flex items-center font-bold px-2 text-xl">=</div><div class="grid gap-1">';

            for (let i = 0; i < rows; i++) {
                html += `<input id="sysB-${i}" class="matrix-cell" type="number" placeholder="b${i}" value="0">`;
            }
            html += '</div>';

            container.innerHTML = html;
            document.getElementById('system-input-area').classList.remove('hidden');
        }

        function solveSystem() {
            try {
                const rows = parseInt(document.getElementById('sys-rows').value);
                const cols = parseInt(document.getElementById('sys-cols').value);

                let A = [], B = [];

                for (let i = 0; i < rows; i++) {
                    let row = [];
                    for (let j = 0; j < cols; j++) {
                        const val = parseFloat(document.getElementById(`sysA-${i}-${j}`).value);
                        row.push(isNaN(val) ? 0 : val);
                    }
                    A.push(row);
                    const bVal = parseFloat(document.getElementById(`sysB-${i}`).value);
                    B.push(isNaN(bVal) ? 0 : bVal);
                }

                // Check if system is solvable
                if (rows !== cols) {
                    showError('system-result', 'System must be square (m = n) for unique solution');
                    return;
                }

                const x = math.lusolve(A, B);

                let resultHtml = '<strong class="text-green-400">Solution Vector X:</strong><br><br>';
                x.forEach((val, i) => {
                    resultHtml += `x${i + 1} = ${val[0].toFixed(6)}<br>`;
                });

                document.getElementById('system-result').innerHTML = resultHtml;
                document.getElementById('system-result').classList.remove('hidden');

            } catch (e) {
                showError('system-result', 'No unique solution exists. System may be singular or inconsistent.');
                console.error('System Solver Error:', e);
            }
        }

        function clearSystem() {
            document.getElementById('system-input-area').classList.add('hidden');
            document.getElementById('system-result').classList.add('hidden');
            document.getElementById('system-grid-container').innerHTML = '';
        }

        // ==================== MATRIX OPERATIONS ====================
        function genMatrixGrid(id) {
            const r = parseInt(document.getElementById(`mat${id}-rows`).value);
            const c = parseInt(document.getElementById(`mat${id}-cols`).value);

            if (r < 1 || c < 1 || r > 8 || c > 8) {
                alert('Matrix dimensions must be between 1 and 8');
                return;
            }
            const div = document.getElementById(`grid-${id}-container`);
            let html = `<div class="grid gap-1" style="grid-template-columns:repeat(${c}, 1fr)">`;

            for (let i = 0; i < r * c; i++) {
                html += `<input id="mat${id}-${Math.floor(i / c)}-${i % c}" type="number" class="matrix-cell" placeholder="0" value="0">`;
            }

            div.innerHTML = html + `</div>`;
        }

        function getMat(id) {
            const r = parseInt(document.getElementById(`mat${id}-rows`).value);
            const c = parseInt(document.getElementById(`mat${id}-cols`).value);
            let m = [];

            for (let i = 0; i < r; i++) {
                let row = [];
                for (let j = 0; j < c; j++) {
                    const val = parseFloat(document.getElementById(`mat${id}-${i}-${j}`).value);
                    row.push(isNaN(val) ? 0 : val);
                }
                m.push(row);
            }

            return math.matrix(m);
        }

        function matBinaryOp(op) {
            try {
                const A = getMat('A');
                const B = getMat('B');
                let res;

                if (op === 'add') res = math.add(A, B);
                else if (op === 'sub') res = math.subtract(A, B);
                else if (op === 'mul') res = math.multiply(A, B);

                showMatRes(res);
            } catch (e) {
                showError('mat-result', 'Operation failed. Check matrix dimensions.');
                console.error('Matrix Operation Error:', e);
            }
        }

        function matUnaryOp(op) {
            try {
                const A = getMat('A');
                let res;

                if (op === 'det') {
                    res = math.det(A);
                } else if (op === 'inv') {
                    res = math.inv(A);
                } else if (op === 'transpose') {
                    res = math.transpose(A);
                } else if (op === 'trace') {
                    res = math.trace(A);
                } else if (op === 'rank') {
                    const arr = A.toArray();
                    const rref = gaussianElimination(arr);
                    let rank = 0;
                    for (let i = 0; i < rref.length; i++) {
                        if (rref[i].some(val => Math.abs(val) > 0.0001)) rank++;
                    }
                    res = rank;
                }

                showMatRes(res);
            } catch (e) {
                showError('mat-result', e.message || 'Operation failed. Matrix may be singular or non-square.');
                console.error('Matrix Operation Error:', e);
            }
        }

        function gaussianElimination(matrix) {
            const m = matrix.map(row => [...row]);
            const rows = m.length;
            const cols = m[0].length;
            let lead = 0;

            for (let r = 0; r < rows; r++) {
                if (lead >= cols) return m;
                let i = r;

                while (Math.abs(m[i][lead]) < 0.0001) {
                    i++;
                    if (i === rows) {
                        i = r;
                        lead++;
                        if (lead === cols) return m;
                    }
                }

                [m[i], m[r]] = [m[r], m[i]];
                const val = m[r][lead];
                for (let j = 0; j < cols; j++) m[r][j] /= val;

                for (let i = 0; i < rows; i++) {
                    if (i !== r) {
                        const val = m[i][lead];
                        for (let j = 0; j < cols; j++) {
                            m[i][j] -= val * m[r][j];
                        }
                    }
                }
                lead++;
            }
            return m;
        }

        function solveEigen() {
            try {
                const A = getMat('A');
                const e = math.eigs(A);

                let html = '<strong class="text-yellow-400">Eigenvalues:</strong><br>';
                html += e.values.toArray().map((v, i) => `λ${i + 1} = ${typeof v === 'object' ? v.re.toFixed(4) + (v.im >= 0 ? '+' : '') + v.im.toFixed(4) + 'i' : v.toFixed(4)}`).join('<br>');
                html += '<br><br><strong class="text-cyan-400">Eigenvectors:</strong><br>';

                e.vectors.toArray().forEach((v, i) => {
                    html += `v${i + 1}: [${v.map(x => typeof x === 'object' ? x.re.toFixed(3) : x.toFixed(3)).join(', ')}]<br>`;
                });

                document.getElementById('mat-result').innerHTML = html;
                document.getElementById('mat-result').classList.remove('hidden');
            } catch (e) {
                showError('mat-result', 'Eigenvalue computation failed. Only works for square matrices.');
                console.error('Eigen Error:', e);
            }
        }

        function showMatRes(val) {
            const div = document.getElementById('mat-result');
            div.classList.remove('hidden');

            if (typeof val === 'object' && val.toArray) {
                const arr = val.toArray();
                let html = '<div class="font-mono">';
                arr.forEach(row => {
                    html += '[' + (Array.isArray(row) ? row.map(v => v.toFixed(4)).join(', ') : row.toFixed(4)) + ']<br>';
                });
                html += '</div>';
                div.innerHTML = html;
            } else {
                div.innerHTML = `<strong>Result:</strong> ${typeof val === 'number' ? val.toFixed(6) : val}`;
            }
        }

        // Initialize matrix grids
        genMatrixGrid('A');
        genMatrixGrid('B');

        // ==================== VECTOR CALCULUS ====================
        function vecCalc(op) {
            const getV = (id) => [
                parseFloat(document.getElementById(id + '-i').value) || 0,
                parseFloat(document.getElementById(id + '-j').value) || 0,
                parseFloat(document.getElementById(id + '-k').value) || 0
            ];

            const A = getV('vecA');
            const B = getV('vecB');
            const div = document.getElementById('vec-result');
            div.classList.remove('hidden');

            let result = '';

            if (op === 'dot') {
                const dotProd = math.dot(A, B);
                result = `<strong>Dot Product (A · B):</strong><br>${dotProd.toFixed(6)}`;
            } else if (op === 'cross') {
                const crossProd = math.cross(A, B);
                result = `<strong>Cross Product (A × B):</strong><br>[${crossProd.map(v => v.toFixed(4)).join(', ')}]`;
            } else if (op === 'mag') {
                const magA = math.norm(A);
                const magB = math.norm(B);
                result = `<strong>Magnitudes:</strong><br>|A| = ${magA.toFixed(6)}<br>|B| = ${magB.toFixed(6)}`;
            } else if (op === 'angle') {
                const dotProd = math.dot(A, B);
                const magA = math.norm(A);
                const magB = math.norm(B);
                const cosTheta = dotProd / (magA * magB);
                const thetaRad = Math.acos(cosTheta);
                const thetaDeg = thetaRad * 180 / Math.PI;
                result = `<strong>Angle between vectors:</strong><br>θ = ${thetaDeg.toFixed(2)}° (${thetaRad.toFixed(4)} rad)<br>cos(θ) = ${cosTheta.toFixed(6)}`;
            }

            div.innerHTML = result;
        }

        // ==================== GEOMETRY & POLYNOMIALS ====================
        function solvePoly() {
            const eq = cleanInput(document.getElementById('poly-eq').value);
            const resDiv = document.getElementById('poly-result');

            try {
                if (typeof Algebrite === 'undefined') {
                    throw new Error("Algebrite library not loaded");
                }

                const res = Algebrite.run(`roots(${eq})`);
                resDiv.innerHTML = `<strong class="text-green-400">Roots:</strong><br>${res}`;
            } catch (e) {
                resDiv.innerHTML = `<span class="text-red-400">Error: Check syntax (e.g., x^2 - 5*x + 6)</span>`;
                console.error('Polynomial Error:', e);
            }
        }

        function solveGeom() {
            const x1 = parseFloat(document.getElementById('geo-x1').value) || 0;
            const y1 = parseFloat(document.getElementById('geo-y1').value) || 0;
            const x2 = parseFloat(document.getElementById('geo-x2').value) || 0;
            const y2 = parseFloat(document.getElementById('geo-y2').value) || 0;
            const m = parseFloat(document.getElementById('geo-m').value) || 1;
            const n = parseFloat(document.getElementById('geo-n').value) || 1;

            const distance = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            const slope = (x2 === x1) ? 'Undefined (Vertical Line)' : ((y2 - y1) / (x2 - x1)).toFixed(6);
            const midX = ((x1 + x2) / 2).toFixed(4);
            const midY = ((y1 + y2) / 2).toFixed(4);

            // Section formula (internal): P = (mx2+nx1)/(m+n), (my2+ny1)/(m+n)
            const secX = ((m * x2 + n * x1) / (m + n)).toFixed(4);
            const secY = ((m * y2 + n * y1) / (m + n)).toFixed(4);

            // Line equation
            let lineEq = '';
            if (x2 === x1) {
                lineEq = `x = ${x1}`;
            } else {
                const slopeVal = (y2 - y1) / (x2 - x1);
                const intercept = y1 - slopeVal * x1;
                lineEq = `y = ${slopeVal.toFixed(4)}x + ${intercept.toFixed(4)}`;
                // Standard form
                const A = (y2 - y1);
                const B = (x1 - x2);
                const C = (A * x1 + B * y1);
                lineEq += `  \u2194  ${A.toFixed(0)}x + ${B.toFixed(0)}y = ${C.toFixed(0)}`;
            }

            let html = `<div class="math-step"><strong class="text-cyan-400">Distance:</strong> ${distance.toFixed(6)}</div>`;
            html += `<div class="math-step"><strong class="text-cyan-400">Slope:</strong> ${slope}</div>`;
            html += `<div class="math-step"><strong class="text-green-400">Midpoint:</strong> (${midX}, ${midY})</div>`;
            html += `<div class="math-step"><strong class="text-green-400">Line Equation:</strong> ${lineEq}</div>`;
            html += `<div class="math-step border-none"><strong class="text-yellow-400">Section Point (${m}:${n}):</strong> (${secX}, ${secY})</div>`;

            document.getElementById('geo-result').innerHTML = html;
        }

        function rectToPolar() {
            const x = parseFloat(document.getElementById('rp-x').value) || 0;
            const y = parseFloat(document.getElementById('rp-y').value) || 0;

            const r = Math.sqrt(x * x + y * y);
            const theta = Math.atan2(y, x) * 180 / Math.PI;

            document.getElementById('rp-result').innerHTML =
                `r = ${r.toFixed(6)}<br>θ = ${theta.toFixed(4)}°`;
        }

        function polarToRect() {
            const r = parseFloat(document.getElementById('pr-r').value) || 0;
            const thetaDeg = parseFloat(document.getElementById('pr-theta').value) || 0;
            const thetaRad = thetaDeg * Math.PI / 180;

            const x = r * Math.cos(thetaRad);
            const y = r * Math.sin(thetaRad);

            document.getElementById('pr-result').innerHTML =
                `x = ${x.toFixed(6)}<br>y = ${y.toFixed(6)}`;
        }

        function convertAngle(type) {
            const val = parseFloat(document.getElementById('angle-val').value);

            if (isNaN(val)) {
                document.getElementById('angle-result').innerHTML = '<span class="text-red-400">Invalid input</span>';
                return;
            }

            if (type === 'd2r') {
                const rad = val * Math.PI / 180;
                document.getElementById('angle-result').innerHTML = `${val}° = ${rad.toFixed(6)} rad`;
            } else {
                const deg = val * 180 / Math.PI;
                document.getElementById('angle-result').innerHTML = `${val} rad = ${deg.toFixed(6)}°`;
            }
        }

        // ==================== CALCULUS SUITE ====================
        let diffMode = 'symbolic';

        // Sub-tab switching within Calculus
        function switchCalcSub(id) {
            document.querySelectorAll('.calc-sub-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('calc-sub-' + id).classList.remove('hidden');

            document.querySelectorAll('.calc-sub-btn').forEach(btn => {
                btn.className = 'calc-sub-btn px-4 py-2 text-xs font-bold uppercase tracking-wider border-b-2 border-transparent text-gray-400 whitespace-nowrap';
            });

            const activeBtn = document.getElementById('btn-calc-' + id);
            const colorMap = { diff: 'green', limit: 'cyan', indef: 'pink', def: 'yellow' };
            const color = colorMap[id] || 'green';
            activeBtn.className = `calc-sub-btn px-4 py-2 text-xs font-bold uppercase tracking-wider border-b-2 border-${color}-400 text-${color}-400 bg-${color}-900 bg-opacity-20 whitespace-nowrap`;
        }

        // Differentiation mode toggle
        function setDiffMode(mode) {
            diffMode = mode;

            document.getElementById('btn-diff-symbolic').className = mode === 'symbolic'
                ? 'flex-1 py-2 px-3 text-xs font-bold border border-green-500 bg-green-900 bg-opacity-40 text-green-300'
                : 'flex-1 py-2 px-3 text-xs font-bold border border-gray-600 text-gray-400';

            document.getElementById('btn-diff-numeric').className = mode === 'numeric'
                ? 'flex-1 py-2 px-3 text-xs font-bold border border-cyan-500 bg-cyan-900 bg-opacity-40 text-cyan-300'
                : 'flex-1 py-2 px-3 text-xs font-bold border border-gray-600 text-gray-400';

            if (mode === 'numeric') {
                document.getElementById('diff-point-input').classList.remove('hidden');
            } else {
                document.getElementById('diff-point-input').classList.add('hidden');
            }
        }

        // --- DIFFERENTIATION ---
        function calcDifferentiation() {
            const f = cleanInput(document.getElementById('diff-f').value);
            const order = parseInt(document.getElementById('diff-order').value);
            const div = document.getElementById('diff-result');
            showSpinner('diff-result');

            setTimeout(() => {
                try {
                    if (typeof Algebrite === 'undefined') {
                        throw new Error("Algebrite library not loaded. Please check your internet connection and refresh.");
                    }

                    // Build repeated differentiation command
                    let expr = f;
                    let steps = '';

                    for (let i = 1; i <= order; i++) {
                        const derivative = Algebrite.run(`d(${expr}, x)`);
                        const ordLabel = i === 1 ? "1st" : i === 2 ? "2nd" : "3rd";
                        steps += `<div class="math-step"><strong class="text-green-400">${ordLabel} Derivative:</strong><br>`;
                        steps += `d/dx (${expr}) = <span class="math-highlight">${derivative}</span></div>`;
                        expr = derivative;
                    }

                    let html = steps;

                    // If numeric mode, also evaluate at the point
                    if (diffMode === 'numeric') {
                        const point = cleanInput(document.getElementById('diff-point').value);
                        try {
                            const numVal = Algebrite.run(`float(subst(${point}, x, ${expr}))`);
                            html += `<div class="mt-3 p-3 bg-black bg-opacity-50 border border-cyan-800">`;
                            html += `<strong class="text-cyan-400">Value at x = ${point}:</strong><br>`;
                            html += `<span class="text-2xl text-yellow-300 font-bold">${numVal}</span></div>`;
                        } catch (e) {
                            html += `<div class="error-message mt-2">Could not evaluate at x = ${point}</div>`;
                        }
                    }

                    div.classList.remove('hidden');
                    div.innerHTML = html;
                } catch (e) {
                    showError('diff-result', e.message || 'Differentiation failed. Check function syntax.');
                    console.error('Differentiation Error:', e);
                }
            }, 100);
        }

        // --- LIMITS ---
        function calcLimitNew() {
            const f = cleanInput(document.getElementById('limit-f').value);
            const a = cleanInput(document.getElementById('limit-a').value);
            const dir = document.getElementById('limit-dir').value;
            const div = document.getElementById('limit-result');
            showSpinner('limit-result');

            setTimeout(() => {
                try {
                    if (typeof Algebrite === 'undefined') {
                        throw new Error("Algebrite library not loaded. Please check your internet connection and refresh.");
                    }

                    let html = '';

                    // Algebrite's limit function: limit(f, x, a)
                    const res = Algebrite.run(`limit(${f}, x, ${a})`);
                    html += `<div class="math-step"><strong class="text-cyan-400">lim (x → ${a}) of ${f}</strong></div>`;

                    if (dir === 'both') {
                        html += `<div class="text-2xl text-yellow-300 font-bold my-3">= ${res}</div>`;
                    } else if (dir === 'left') {
                        // For left-hand limit, try numerical approach from left
                        html += `<div class="text-lg text-yellow-300 font-bold my-3">From Left (x → ${a}⁻) = ${res}</div>`;
                        try {
                            const aNum = Algebrite.run(`float(${a})`);
                            const nearLeft = parseFloat(aNum) - 0.00001;
                            const numApprox = Algebrite.run(`float(subst(${nearLeft}, x, ${f}))`);
                            html += `<div class="text-xs text-gray-400">Numerical check (x = ${nearLeft}): f(x) ≈ ${numApprox}</div>`;
                        } catch (e) { /* skip numerical check if it fails */ }
                    } else if (dir === 'right') {
                        html += `<div class="text-lg text-yellow-300 font-bold my-3">From Right (x → ${a}⁺) = ${res}</div>`;
                        try {
                            const aNum = Algebrite.run(`float(${a})`);
                            const nearRight = parseFloat(aNum) + 0.00001;
                            const numApprox = Algebrite.run(`float(subst(${nearRight}, x, ${f}))`);
                            html += `<div class="text-xs text-gray-400">Numerical check (x = ${nearRight}): f(x) ≈ ${numApprox}</div>`;
                        } catch (e) { /* skip */ }
                    }

                    div.classList.remove('hidden');
                    div.innerHTML = html;
                } catch (e) {
                    showError('limit-result', e.message || 'Limit calculation failed. Check function syntax.');
                    console.error('Limit Error:', e);
                }
            }, 100);
        }

        // --- INDEFINITE INTEGRAL ---
        function calcIndefiniteIntegral() {
            const f = cleanInput(document.getElementById('indef-f').value);
            const v = cleanInput(document.getElementById('indef-var').value) || 'x';
            const div = document.getElementById('indef-result');
            showSpinner('indef-result');

            setTimeout(() => {
                try {
                    if (typeof Algebrite === 'undefined') {
                        throw new Error("Algebrite library not loaded. Please check your internet connection and refresh.");
                    }

                    const res = Algebrite.run(`integral(${f}, ${v})`);

                    let html = `<div class="math-step">`;
                    html += `<strong class="text-pink-400">∫ (${f}) d${v}</strong></div>`;
                    html += `<div class="text-2xl text-yellow-300 font-bold my-3">= ${res} + C</div>`;

                    // Show verification: d/dv of result should give back f
                    try {
                        const verify = Algebrite.run(`simplify(d(${res}, ${v}))`);
                        html += `<div class="mt-2 p-2 bg-black bg-opacity-50 border border-gray-800 text-xs">`;
                        html += `<strong class="text-gray-400">Verification:</strong> d/d${v} [${res}] = ${verify}</div>`;
                    } catch (e) { /* skip verification if it causes issues */ }

                    div.classList.remove('hidden');
                    div.innerHTML = html;
                } catch (e) {
                    showError('indef-result', e.message || 'Integration failed. Check function syntax.');
                    console.error('Indefinite Integral Error:', e);
                }
            }, 100);
        }

        // --- DEFINITE INTEGRAL ---
        function calcDefiniteIntegral() {
            const f = cleanInput(document.getElementById('def-f').value);
            const a = cleanInput(document.getElementById('def-a').value);
            const b = cleanInput(document.getElementById('def-b').value);
            const v = cleanInput(document.getElementById('def-var').value) || 'x';
            const div = document.getElementById('def-result');
            showSpinner('def-result');

            setTimeout(() => {
                try {
                    if (typeof Algebrite === 'undefined') {
                        throw new Error("Algebrite library not loaded. Please check your internet connection and refresh.");
                    }

                    // First find the antiderivative
                    const antideriv = Algebrite.run(`integral(${f}, ${v})`);

                    // Evaluate at upper bound
                    const atB = Algebrite.run(`subst(${b}, ${v}, ${antideriv})`);
                    // Evaluate at lower bound
                    const atA = Algebrite.run(`subst(${a}, ${v}, ${antideriv})`);
                    // Compute the difference
                    const result = Algebrite.run(`simplify(${atB} - (${atA}))`);
                    // Get numerical value
                    const numResult = Algebrite.run(`float(${result})`);

                    let html = `<div class="math-step">`;
                    html += `<strong class="text-yellow-400">∫ from ${a} to ${b} of (${f}) d${v}</strong></div>`;

                    html += `<div class="math-step">`;
                    html += `<strong class="text-gray-400">Step 1 — Antiderivative:</strong><br>`;
                    html += `F(${v}) = ${antideriv}</div>`;

                    html += `<div class="math-step">`;
                    html += `<strong class="text-gray-400">Step 2 — Apply bounds:</strong><br>`;
                    html += `F(${b}) = ${atB}<br>`;
                    html += `F(${a}) = ${atA}<br>`;
                    html += `F(${b}) - F(${a}) = ${atB} - (${atA})</div>`;

                    html += `<div class="mt-3 p-3 bg-black bg-opacity-50 border border-yellow-800">`;
                    html += `<strong class="text-yellow-400">Result (Exact):</strong>`;
                    html += `<span class="text-2xl text-yellow-300 font-bold ml-3">${result}</span></div>`;

                    if (numResult !== result) {
                        html += `<div class="mt-1 p-2 bg-black bg-opacity-50 border border-gray-800">`;
                        html += `<strong class="text-gray-400">Decimal Approximation:</strong>`;
                        html += `<span class="text-lg text-green-400 font-bold ml-3">≈ ${numResult}</span></div>`;
                    }

                    div.classList.remove('hidden');
                    div.innerHTML = html;
                } catch (e) {
                    showError('def-result', e.message || 'Definite integral evaluation failed. Check syntax and bounds.');
                    console.error('Definite Integral Error:', e);
                }
            }, 100);
        }


        // ==================== DIFFERENTIAL EQUATIONS ====================

        // FIXED: Improved Exact DE logic
        function solveExactDE() {
            const M = cleanInput(document.getElementById('de-m').value);
            const N = cleanInput(document.getElementById('de-n').value);
            const resDiv = document.getElementById('de-exact-res');

            try {
                if (typeof Algebrite === 'undefined') {
                    throw new Error("Algebrite library not loaded");
                }

                const dMdy = Algebrite.run(`d(${M}, y)`);
                const dNdx = Algebrite.run(`d(${N}, x)`);

                let out = `<div class="math-step">∂M/∂y = ${dMdy}<br>∂N/∂x = ${dNdx}</div>`;

                // SMART FIX: Check exactness by subtraction instead of string comparison
                const diff = Algebrite.run(`simplify(${dMdy} - (${dNdx}))`);

                if (diff === "0" || dMdy === dNdx) {
                    out += '<div class="success-message">✓ Equation is EXACT</div>';
                    try {
                        const sol = Algebrite.run(`integral(${M}, x) + integral(simplify(${N} - d(integral(${M}, x), y)), y)`);
                        out += `<div class="mt-2"><strong class="text-green-400">Solution:</strong><br>${sol} = C</div>`;
                    } catch (e) {
                        out += '<div class="mt-2 text-yellow-300">Solution exists but integration too complex for automatic solving.</div>';
                    }
                } else {
                    out += '<div class="error-message">✗ Equation is NOT EXACT<br>An integrating factor may be needed.</div>';
                }

                resDiv.innerHTML = out;
            } catch (e) {
                resDiv.innerHTML = `<span class="text-red-400">Error: ${e.message}</span>`;
                console.error('Exact DE Error:', e);
            }
        }

        function solveLinearDE() {
            const P = cleanInput(document.getElementById('de-p').value);
            const Q = cleanInput(document.getElementById('de-q').value);
            const resDiv = document.getElementById('de-linear-res');

            try {
                if (typeof Algebrite === 'undefined') {
                    throw new Error("Algebrite library not loaded");
                }

                const IF = Algebrite.run(`exp(integral(${P}, x))`);
                resDiv.innerHTML = `<strong>Integrating Factor (I.F.):</strong><br>μ(x) = ${IF}<br><br><strong class="text-green-400">Solution:</strong><br>y · (${IF}) = ∫(${Q}) · (${IF}) dx + C`;
            } catch (e) {
                resDiv.innerHTML = `<span class="text-red-400">Error: ${e.message}</span>`;
                console.error('Linear DE Error:', e);
            }
        }

        function solveLinearHigherOrder() {
            const aux = cleanInput(document.getElementById('de-aux').value);
            const rhs = cleanInput(document.getElementById('de-rhs').value);
            const resDiv = document.getElementById('de-ho-res');

            try {
                if (typeof Algebrite === 'undefined') {
                    throw new Error("Algebrite library not loaded");
                }

                let poly = aux.replace(/D/g, 'x');
                const roots = Algebrite.run(`roots(${poly})`);

                let html = `<strong>Auxiliary Equation:</strong> ${aux} = 0<br><br>`;
                html += `<strong>Roots (m):</strong><br>${roots}<br><br>`;
                html += `<strong class="text-yellow-400">Complementary Function (C.F.):</strong><br>`;
                html += `Construct based on root types:<br>`;
                html += `• Real & Distinct: c₁e^(m₁x) + c₂e^(m₂x) + ...<br>`;
                html += `• Repeated (m, multiplicity n): (c₁ + c₂x + ... + cₙx^(n-1))e^(mx)<br>`;
                html += `• Complex (α ± iβ): e^(αx)(c₁cos(βx) + c₂sin(βx))<br><br>`;
                html += `<strong>Particular Integral (P.I.):</strong><br>Find for RHS = ${rhs} using appropriate method.`;

                resDiv.innerHTML = html;
            } catch (e) {
                resDiv.innerHTML = `<span class="text-red-400">Error: ${e.message}</span>`;
                console.error('Higher Order DE Error:', e);
            }
        }

        // ==================== ORTHOGONAL TRAJECTORIES ====================
        let orthoMode = 'eq';

        function setOrthoMode(mode) {
            orthoMode = mode;

            document.getElementById('btn-ortho-eq').className = mode === 'eq' ?
                'flex-1 py-1 px-2 border border-pink-500 bg-pink-900 text-white' :
                'flex-1 py-1 px-2 border border-gray-600 text-gray-400';

            document.getElementById('btn-ortho-slope').className = mode === 'slope' ?
                'flex-1 py-1 px-2 border border-pink-500 bg-pink-900 text-white' :
                'flex-1 py-1 px-2 border border-gray-600 text-gray-400';

            if (mode === 'eq') {
                document.getElementById('ortho-mode-eq').classList.remove('hidden');
                document.getElementById('ortho-mode-slope').classList.add('hidden');
            } else {
                document.getElementById('ortho-mode-eq').classList.add('hidden');
                document.getElementById('ortho-mode-slope').classList.remove('hidden');
            }
        }

        function solveOrthogonal() {
            const resDiv = document.getElementById('ot-res');
            resDiv.innerHTML = '<div class="loading-spinner"></div>';

            setTimeout(() => {
                try {
                    if (typeof Algebrite === 'undefined') {
                        throw new Error("Algebrite library not loaded");
                    }

                    let originalSlope = "";
                    let logSteps = "";

                    if (orthoMode === 'eq') {
                        let eq = cleanInput(document.getElementById('ot-eq').value);

                        if (!eq.includes('=')) {
                            throw "Invalid equation. Must contain '=' symbol.";
                        }

                        let parts = eq.split('=');
                        let F_xy = "";
                        let constantChar = 'c';

                        let cleanEq = eq.replace(/\s/g, '');

                        if (cleanEq.includes('a') && !cleanEq.includes('tan') && !cleanEq.includes('sin') && !cleanEq.includes('cos')) {
                            constantChar = 'a';
                        } else if (cleanEq.includes('k') && !cleanEq.includes('cos')) {
                            constantChar = 'k';
                        }

                        if (cleanEq.startsWith('y=') && (cleanEq.includes(constantChar + '*') || cleanEq.includes('*' + constantChar))) {
                            let rhs = cleanEq.split('=')[1];
                            let func = rhs.replace(new RegExp(constantChar + '\\*|\\*' + constantChar, 'g'), '');
                            F_xy = `y / (${func})`;
                        } else if (parts[1].trim() === constantChar || parts[1].trim() === constantChar + "^2") {
                            F_xy = parts[0];
                        } else {
                            F_xy = parts[0];
                        }

                        logSteps += `<div class="math-step">Step 1: Family Equation<br><span class="math-highlight">F(x,y) = ${constantChar}</span><br>where F = ${F_xy}</div>`;

                        const Fx = Algebrite.run(`d(${F_xy}, x)`);
                        const Fy = Algebrite.run(`d(${F_xy}, y)`);

                        logSteps += `<div class="math-step">Step 2: Partial Derivatives<br>∂F/∂x = ${Fx}<br>∂F/∂y = ${Fy}</div>`;

                        originalSlope = Algebrite.run(`simplify(-1 * (${Fx}) / (${Fy}))`);
                        logSteps += `<div class="math-step">Step 3: Slope of Original Family<br><span class="math-highlight">dy/dx = -Fx/Fy = ${originalSlope}</span></div>`;

                    } else {
                        originalSlope = cleanInput(document.getElementById('ot-slope').value);
                        logSteps += `<div class="math-step">Step 1: Given Slope<br><span class="math-highlight">dy/dx = ${originalSlope}</span></div>`;
                    }

                    const orthSlope = Algebrite.run(`simplify(-1 / (${originalSlope}))`);
                    logSteps += `<div class="math-step">Step 4: Orthogonal Slope<br><span class="math-highlight">dy/dx = -1/m = ${orthSlope}</span></div>`;

                    logSteps += `<div class="math-step">Step 5: Solve Differential Equation</div>`;

                    let integrationResult = "";

                    if (!orthSlope.includes('y')) {
                        try {
                            let resX = Algebrite.run(`integral(${orthSlope}, x)`);
                            integrationResult = `y = ${resX} + C`;
                        } catch (e) {
                            integrationResult = `∫ dy = ∫ (${orthSlope}) dx + C`;
                        }
                    } else if (orthSlope === "y/x") {
                        integrationResult = "dy/y = dx/x → ln|y| = ln|x| + ln|C| → <strong>y = Cx</strong>";
                    } else if (orthSlope === "-x/y") {
                        integrationResult = "y dy = -x dx → y²/2 = -x²/2 + C → <strong>x² + y² = C</strong>";
                    } else if (orthSlope === "x/y") {
                        integrationResult = "y dy = x dx → y²/2 = x²/2 + C → <strong>y² - x² = C</strong>";
                    } else if (orthSlope === "-y/x") {
                        integrationResult = "dy/y = -dx/x → ln|y| = -ln|x| + ln|C| → <strong>y = C/x</strong>";
                    } else {
                        integrationResult = `Separate: dy = (${orthSlope}) dx<br>Integrate both sides to get solution.`;
                    }

                    logSteps += `<div class="math-step border-none mt-2"><strong class="text-pink-400">Orthogonal Trajectory:</strong><br><span class="text-lg text-yellow-300">${integrationResult}</span></div>`;

                    resDiv.innerHTML = logSteps;

                } catch (e) {
                    resDiv.innerHTML = `<div class="error-message">${e.message || e}<br><small>Tip: Use format "x^2 + y^2 = c" or "y = c*x^2"</small></div>`;
                    console.error('Orthogonal Error:', e);
                }
            }, 300);
        }

        // ==================== GRADER ====================
        function calcGrade() {
            const total = parseFloat(document.getElementById('grade-total').value);
            const obt = parseFloat(document.getElementById('grade-obt').value);

            if (isNaN(total) || isNaN(obt) || total === 0) {
                showError('grade-result', 'Please enter valid marks');
                return;
            }

            if (obt > total) {
                showError('grade-result', 'Obtained marks cannot exceed total marks');
                return;
            }

            const perc = (obt / total) * 100;
            let grade = '', point = 0, color = '';

            if (perc >= 95) { grade = 'O (Outstanding)'; point = 10; color = 'text-green-400'; }
            else if (perc >= 90) { grade = 'A+ (Excellent)'; point = 9; color = 'text-green-300'; }
            else if (perc >= 80) { grade = 'A (Very Good)'; point = 8; color = 'text-cyan-400'; }
            else if (perc >= 70) { grade = 'B+ (Good)'; point = 7; color = 'text-cyan-300'; }
            else if (perc >= 60) { grade = 'B (Above Average)'; point = 6; color = 'text-blue-400'; }
            else if (perc >= 50) { grade = 'C (Average)'; point = 5; color = 'text-yellow-400'; }
            else if (perc >= 40) { grade = 'P (Pass)'; point = 4; color = 'text-orange-400'; }
            else { grade = 'F (Fail)'; point = 0; color = 'text-red-400'; }

            const div = document.getElementById('grade-result');
            div.classList.remove('hidden');
            div.innerHTML = `
                <div class="text-center">
                    <div class="text-4xl font-bold ${color} mb-4">${perc.toFixed(2)}%</div>
                    <div class="text-2xl ${color} font-bold mb-2">${grade}</div>
                    <div class="text-xl">Grade Point: <span class="${color} font-bold">${point}</span></div>
                </div>
            `;
        }

        // ==================== SGPA CALCULATOR ====================
        function generateSGPAGrid() {
            const count = parseInt(document.getElementById('sgpa-count').value) || 6;
            const grid = document.getElementById('sgpa-grid');
            let html = '';
            html += `<div class="grid grid-cols-12 gap-1 text-xs text-gray-400 font-bold mb-1 px-1">`;
            html += `<div class="col-span-1">#</div>`;
            html += `<div class="col-span-5">Subject Name</div>`;
            html += `<div class="col-span-3">Credits</div>`;
            html += `<div class="col-span-3">Grade Point</div>`;
            html += `</div>`;

            for (let i = 0; i < count; i++) {
                html += `<div class="grid grid-cols-12 gap-1 items-center">`;
                html += `<div class="col-span-1 text-gray-600 text-xs font-bold">${i + 1}</div>`;
                html += `<input id="sgpa-name-${i}" class="col-span-5 text-xs" placeholder="Subject ${i + 1}" style="padding:6px;">`;
                html += `<input id="sgpa-credit-${i}" type="number" class="col-span-3 text-xs" value="4" min="1" max="10" style="padding:6px;">`;
                html += `<select id="sgpa-gp-${i}" class="col-span-3 text-xs" style="padding:6px;">`;
                html += `<option value="10">O (10)</option>`;
                html += `<option value="9">A+ (9)</option>`;
                html += `<option value="8" selected>A (8)</option>`;
                html += `<option value="7">B+ (7)</option>`;
                html += `<option value="6">B (6)</option>`;
                html += `<option value="5">C (5)</option>`;
                html += `<option value="4">P (4)</option>`;
                html += `<option value="0">F (0)</option>`;
                html += `</select>`;
                html += `</div>`;
            }
            grid.innerHTML = html;
        }

        function calcSGPA() {
            const count = parseInt(document.getElementById('sgpa-count').value) || 6;
            let totalCredits = 0;
            let totalPoints = 0;
            let subjects = [];

            for (let i = 0; i < count; i++) {
                const nameEl = document.getElementById(`sgpa-name-${i}`);
                const creditEl = document.getElementById(`sgpa-credit-${i}`);
                const gpEl = document.getElementById(`sgpa-gp-${i}`);
                if (!creditEl || !gpEl) continue;

                const name = nameEl ? nameEl.value || `Subject ${i + 1}` : `Subject ${i + 1}`;
                const credit = parseFloat(creditEl.value) || 0;
                const gp = parseFloat(gpEl.value) || 0;

                subjects.push({ name, credit, gp, score: credit * gp });
                totalCredits += credit;
                totalPoints += credit * gp;
            }

            if (totalCredits === 0) {
                showError('sgpa-result', 'Please set up subjects first (click SET)');
                return;
            }

            const sgpa = totalPoints / totalCredits;
            const pct = (sgpa - 0.75) * 10; // Approx percentage (SPPU formula)
            const creditsEarned = subjects.filter(s => s.gp > 0).reduce((sum, s) => sum + s.credit, 0);

            let html = `<div class="text-center mb-4">`;
            html += `<div class="text-4xl font-bold text-yellow-300 mb-2">${sgpa.toFixed(2)}</div>`;
            html += `<div class="text-sm text-gray-400">SGPA</div>`;
            html += `<div class="text-sm text-gray-500 mt-1">Approx Percentage: ${pct.toFixed(1)}%</div>`;
            html += `<div class="grid grid-cols-2 gap-3 mt-3 text-sm">`;
            html += `<div class="p-2 border border-gray-800 bg-black bg-opacity-50 text-center"><div class="text-gray-500 text-xs">Total Credits</div><div class="text-lg font-bold text-cyan-400">${totalCredits}</div></div>`;
            html += `<div class="p-2 border border-gray-800 bg-black bg-opacity-50 text-center"><div class="text-gray-500 text-xs">Credits Earned</div><div class="text-lg font-bold ${creditsEarned === totalCredits ? 'text-green-400' : 'text-orange-400'}">${creditsEarned}</div></div>`;
            html += `</div>`;
            html += `</div>`;

            html += `<div class="text-xs border-t border-gray-800 pt-2 mt-2">`;
            html += `<div class="grid grid-cols-12 gap-1 text-gray-500 font-bold mb-1">`;
            html += `<div class="col-span-5">Subject</div><div class="col-span-2">Cr</div><div class="col-span-2">GP</div><div class="col-span-3">Cr×GP</div></div>`;
            subjects.forEach(s => {
                const gpColor = s.gp >= 8 ? 'text-green-400' : s.gp >= 6 ? 'text-cyan-400' : s.gp >= 4 ? 'text-yellow-400' : 'text-red-400';
                html += `<div class="grid grid-cols-12 gap-1">`;
                html += `<div class="col-span-5 text-gray-300 truncate">${s.name}</div>`;
                html += `<div class="col-span-2">${s.credit}</div>`;
                html += `<div class="col-span-2 ${gpColor}">${s.gp}</div>`;
                html += `<div class="col-span-3">${s.score}</div>`;
                html += `</div>`;
            });
            html += `<div class="grid grid-cols-12 gap-1 font-bold border-t border-gray-700 mt-1 pt-1">`;
            html += `<div class="col-span-5 text-pink-400">TOTAL</div>`;
            html += `<div class="col-span-2">${totalCredits}</div>`;
            html += `<div class="col-span-2"></div>`;
            html += `<div class="col-span-3 text-yellow-300">${totalPoints}</div>`;
            html += `</div></div>`;

            const div = document.getElementById('sgpa-result');
            div.classList.remove('hidden');
            div.innerHTML = html;
        }

        // ==================== GRAPHER (MULTI-FUNCTION) ====================
        function plotGraph() {
            const funcs = [
                { id: 'graph-func', color: '#0f0', name: 'f\u2081(x)' },
                { id: 'graph-func2', color: '#0ff', name: 'f\u2082(x)' },
                { id: 'graph-func3', color: '#f0f', name: 'f\u2083(x)' }
            ];
            const xMin = parseFloat(document.getElementById('x-min').value) || -10;
            const xMax = parseFloat(document.getElementById('x-max').value) || 10;

            try {
                const traces = [];
                const step = (xMax - xMin) / 500;

                funcs.forEach(fn => {
                    const fVal = document.getElementById(fn.id).value.trim();
                    if (!fVal) return; // Skip empty inputs

                    const expr = math.compile(fVal);
                    const x = [], y = [];

                    for (let val = xMin; val <= xMax; val += step) {
                        try {
                            const yVal = expr.evaluate({ x: val });
                            if (typeof yVal === 'number' && isFinite(yVal)) {
                                x.push(val);
                                y.push(yVal);
                            }
                        } catch (e) { /* skip */ }
                    }

                    if (x.length > 0) {
                        traces.push({
                            x: x, y: y,
                            type: 'scatter', mode: 'lines',
                            line: { color: fn.color, width: 2 },
                            name: `${fn.name} = ${fVal}`
                        });
                    }
                });

                if (traces.length === 0) {
                    throw new Error('No valid points to plot');
                }

                Plotly.newPlot('plot-area', traces, {
                    paper_bgcolor: '#000',
                    plot_bgcolor: '#111',
                    font: { color: '#0f0', family: 'Courier New' },
                    margin: { t: 40, b: 50, l: 60, r: 20 },
                    xaxis: {
                        gridcolor: '#222',
                        title: 'x',
                        zeroline: true,
                        zerolinecolor: '#444'
                    },
                    yaxis: {
                        gridcolor: '#222',
                        title: 'f(x)',
                        zeroline: true,
                        zerolinecolor: '#444'
                    },
                    legend: {
                        bgcolor: 'rgba(0,0,0,0.8)',
                        bordercolor: '#333',
                        borderwidth: 1,
                        font: { color: '#ddd', size: 11 }
                    }
                });
            } catch (e) {
                document.getElementById('plot-area').innerHTML =
                    '<div class="error-message m-4"><i class="fas fa-exclamation-triangle"></i> Error: Invalid function or no valid points to plot</div>';
                console.error('Plot Error:', e);
            }
        }

        // ==================== INITIALIZE ====================
        switchTab('sci');
        generateSGPAGrid(); // Pre-generate SGPA grid

        // Global Enter key handler for form inputs
        document.addEventListener('keydown', function (e) {
            if (e.key !== 'Enter') return;
            const el = e.target;
            if (el.tagName !== 'INPUT' && el.tagName !== 'SELECT') return;
            if (el.id === 'sci-screen') return; // Handled separately

            e.preventDefault();
            // Find the nearest button and click it
            const parent = el.closest('.tab-content, .calc-sub-content, .glass-panel');
            if (parent) {
                const btn = parent.querySelector('.cyber-btn');
                if (btn) btn.click();
            }
        });

        console.log('%c\u26a1 ENG_CALC v4.0 LOADED', 'color: #0f0; font-size: 16px; font-weight: bold');
    </script>
</body>

</html>